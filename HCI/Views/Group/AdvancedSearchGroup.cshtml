@model HCI.Models.SearchGroupQueryModel

@{
    ViewBag.Title = "Advanced Search Group";
}

<h2>Advanced Search Group</h2>

@section scripts
{
    <script type="text/javascript">
        var patt = /index/;

        function resetConditionGroupID()
        {
            var conditionGroups = $('form').children('.form-group:not(:hidden)');
            var cnt = conditionGroups.length;

            for (var i=0; i< cnt; i++)
            {
                if (i==0)
                {
                    if (cnt == 1)
                    {
                        add = true;
                        remove = false;
                    }
                    else
                    {
                        add = false;
                        remove = false;
                    }
                }
                else
                {
                    if (i == cnt -1)
                    {
                        add = true;
                        remove = false;
                    }
                    else
                    {
                        add = false;
                        remove = true;
                    }
                }

                setConditionGroupID(i, conditionGroups.eq(i), add, remove);
            }

        }

        function setConditionGroupID(id, jsection, add, remove)
        {
            jsection.prop('id', 'conditionGroup-' + id);

            jsection.find('#addLink').prop('hidden', !add);
            jsection.find('#removeLink').prop('hidden', !remove);

            var jnode;
            jnode = jsection.find('#CombineType');
            if (jnode.length) {
                jnode.prop('name', 'QueryList[' + id + '].CombineType');
            }

            jnode = jsection.find('#SearchType');
            jnode.prop('name', 'QueryList[' + id + '].SearchType');

            jnode = jsection.find('#SearchVerbType');
            jnode.prop('name', 'QueryList[' + id + '].SearchVerbType');

            jnode = jsection.find('#SearchValue');
            jnode.prop('name', 'QueryList[' + id + '].SearchValue');
        }

        $(document).ready(function ($) {
            $(function () {
                $('#conditionGroup-0 #SearchValue').focus();
            })
        });

        $(document).ready(function ($) {
            $(function () {
                $('[data-toggle="tooltip"]').tooltip();
            })
        });

        $(document).ready(function ($) {
            $(function () {
                $("#advancedSearchedForm").delegate("#addLink", "click",
                    function (evt) {
                        var newCondtionGroup = $('#conditionGroup-index').clone(true);
                        var conditionGroup = $(this).parent().parent();

                        conditionGroup.after(newCondtionGroup);
                        newCondtionGroup.prop('hidden', false);

                        resetConditionGroupID();
                    });

                $("#advancedSearchedForm").delegate("#removeLink", "click",
                    function (evt) {
                        var conditionGroup = $(this).parent().parent();
                        conditionGroup.remove();
                        resetConditionGroupID();
                    });
            })
        });

        

    </script>
}

@section css{
    
}


<div style="height:30px"></div>
@using (Html.BeginForm("SearchGroupResult", "Group", FormMethod.Post, htmlAttributes: new { @class = "form-horizontal", @role = "form", @id="advancedSearchedForm" }))
{
    <input id="IsAdvancedSearch" name="IsAdvancedSearch" type="hidden" value="true" />
    <div class="form-group" id="conditionGroup-0">
        <div class="col-md-2">
        </div>
        <div class="col-md-1" style="max-width: 80px;padding-left:0px;padding-right: 0px;">
            <input type="hidden" class="form-control" id="CombineType" name="QueryList[0].CombineType" value="And"/>
        </div>
        <div class="col-md-2" style="max-width: 170px;">
            <select class="form-control" id="SearchType" name="QueryList[0].SearchType" style="min-width:100%">
                <option value="Group Name" selected>Group Name</option>
                <option value="Study Field">Study Field</option>
                <option value="Course ID">Course ID</option>
                <option value="Description">Description</option>
                <option value="Group Owner">Group Owner</option>
            </select>
        </div>
        <div class="col-md-2" style="max-width: 135px; padding-left:0px; padding-right:0px">
            <select class="form-control" id="SearchVerbType" name="QueryList[0].SearchVerbType" style="min-width:100%">
                <option value="Equals" selected>Equals</option>
                <option value="Not Equals">Not Equals</option>
                <option value="Contains">Contains</option>
                <option value="Not Contains">Not Contains</option>
            </select>
        </div>
        <div class="col-md-4">
            <input class="form-control" id="SearchValue" name="QueryList[0].SearchValue" style="min-width:100%" type="text" value=""/>
        </div>
    </div>

    <div class="form-group" id="conditionGroup-1">
        <div class="col-md-2">
        </div>
        <div class="col-md-1" style="max-width: 80px;padding-left:0px;padding-right: 0px;">
            <select class="form-control" id="CombineType" name="QueryList[1].CombineType" style="min-width:100%">
                <option value="And" selected>And</option>
                <option value="Or">Or</option>
            </select>
        </div>
        <div class="col-md-2" style="max-width: 170px;">
            <select class="form-control" id="SearchType" name="QueryList[1].SearchType" style="min-width:100%">
                <option value="Group Name" selected>Group Name</option>
                <option value="Study Field">Study Field</option>
                <option value="Course ID">Course ID</option>
                <option value="Description">Description</option>
                <option value="Group Owner">Group Owner</option>
            </select>
        </div>
        <div class="col-md-2" style="max-width: 135px; padding-left:0px; padding-right:0px">
            <select class="form-control" id="SearchVerbType" name="QueryList[1].SearchVerbType" style="min-width:100%">
                <option value="Equals" selected>Equals</option>
                <option value="Not Equals">Not Equals</option>
                <option value="Contains">Contains</option>
                <option value="Not Contains">Not Contains</option>
            </select>
        </div>
        <div class="col-md-4">
            <input class="form-control" id="SearchValue" name="QueryList[1].SearchValue" style="min-width:100%" type="text" value="" />
        </div>
        <div class="col-md-2" style="padding-top: 7px;">
            <a href="javascript:void(0)" id="addLink">Add another condition</a>
            <a href="javascript:void(0)" id="removeLink" hidden>Remove</a>
        </div>
    </div>
    
    <div class="form-group" id="conditionGroup-index" hidden>
        <div class="col-md-2">
        </div>
        <div class="col-md-1" style="max-width: 80px;padding-left:0px;padding-right: 0px;">
            <select class="form-control" id="CombineType" name="QueryList[index].CombineType" style="min-width:100%">
                <option value="And" selected>And</option>
                <option value="Or">Or</option>
            </select>
        </div>
        <div class="col-md-2" style="max-width: 170px;">
            <select class="form-control" id="SearchType" name="QueryList[index].SearchType" style="min-width:100%">
                <option value="Group Name" selected>Group Name</option>
                <option value="Study Field">Study Field</option>
                <option value="Course ID">Course ID</option>
                <option value="Description">Description</option>
                <option value="Group Owner">Group Owner</option>
            </select>
        </div>
        <div class="col-md-2" style="max-width: 135px; padding-left:0px; padding-right:0px">
            <select class="form-control" id="SearchVerbType" name="QueryList[1].SearchVerbType" style="min-width:100%">
                <option value="Equals" selected>Equals</option>
                <option value="Not Equals">Not Equals</option>
                <option value="Contains">Contains</option>
                <option value="Not Contains">Not Contains</option>
            </select>
        </div>
        <div class="col-md-4">
            <input class="form-control" id="SearchValue" name="QueryList[index].SearchValue" style="min-width:100%" type="text" value="" />
        </div>
        <div class="col-md-2" style="padding-top: 7px;">
            <a href="javascript:void(0)" id="addLink">Add another condition</a>
            <a href="javascript:void(0)" id="removeLink" hidden>Remove</a>
        </div>
    </div>

    <div class="col-md-12" style="margin-left: 40%;">
        <button type="submit" class="btn btn-default" style="min-width: 200px;">
            Search
        </button>
    </div>
}
